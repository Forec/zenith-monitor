{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "main/_macros.html" as macros %}

{% block title %}顶点云 - 设备{% endblock %}

{% block page_content %}
<section id="top" class="two">
    <div class="container">
        <header>

            <div class="post-content">
                <div class="post-header">
                    <div class="post-author">
                        <p style="line-height:100%;margin:6px 0px 0px 0px">
                        设备名：{{ device.name }}
                        </p>
                    </div>

                    <div class="post-date">
                        创建时间：{{ moment(device.created).fromNow() }}
                    </div>
                </div>

                <div class="post-body">
                    {% if file.isdir %}
                    <b>目录描述：</b>
                    {% else %}
                    <b>文件描述：</b>
                    {% endif %}
                    {% if file.description %}
                        {% if file.description == "" %}
                            无
                        {% else %}
                            {{ file.description }}
                        {% endif %}
                    {% else %}
                        无
                    {% endif %}
                </div>

                <div class="post-footer">
                    <span class="dropdown">
                        <span class = "label label-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">操作</span>

                        <ul class="dropdown-menu dropdown-menu-right">
                            {% if file.private == False or current_user == file.owner or current_user.is_administrator()%}
                                <li><a href="{{ url_for('main.download', id=file.uid, _external=True) }}">下载</a></li>
                            {% endif %}

                            {% if file.private == False and current_user != file.owner and current_user.is_authenticated%}
                                <li><a href="{{ url_for('main.fork', id=file.uid, _external=True) }}">Fork</a></li>
                            {% endif %}

                            {% if file.isdir and current_user != file.owner %}
                                <li><a href="{{ url_for('main.view_share_folder_entry', id=file.uid, _external=True) }}">进入目录</a></li>
                            {% endif %}

                            {% if current_user == file.owner %}
                                <li><a href="{{ url_for('main.copy', id=file.uid, path='/', _external=True) }}">复制</a></li>
                                <li><a href="{{ url_for('main.move', id=file.uid, path='/', _external=True) }}">移动</a></li>
                                <li><a href="{{ url_for('main.edit_file', id=file.uid, _external=True) }}">编辑</a></li>
                                <li><a href="{{ url_for('main.delete_file',id=file.uid, _external=True) }}">删除</a></li>
                                {% if file.private %}
                                    <li><a href="{{ url_for('main.set_share', id=file.uid, _external=True) }}">共享</a></li>
                                {% else %}
                                    <li><a href="{{ url_for('main.set_private', id=file.uid, _external=True) }}">取消共享</a></li>
                                {% endif %}
                            {% elif current_user.is_administrator() %}
                                <li><a href="{{ url_for('main.moderate_files_delete',id=file.uid, _external=True) }}">删除 [管理员]</a></li>
                                {% if file.private %}
                                    <li><a href="{{ url_for('main.set_share', id=file.uid, _external=True) }}">共享 [管理员]</a></li>
                                {% else %}
                                    <li><a href="{{ url_for('main.set_private', id=file.uid, _external=True) }}">取消共享 [管理员]</a></li>
                                {% endif %}
                            {% endif %}

                            <li><a href="{{ url_for('.file', id=file.uid, _external=True) }}">资源外链</a></li>
                        </ul>
                    </span>
                </div>
            </div>
            <div style="text-align:left">
            <h4 id="comments">评论 共 {{ file.comments.count() }} 条</h4>
            {% if current_user.can(Permission.COMMENT) %}
            <div class="comment-form">
                {{ wtf.quick_form(form) }}
            </div>
            {% endif %}
            {% include 'main/_comments.html' %}
            {% if pagination %}
            <div class="pagination">
                {{ macros.pagination_widget(pagination, '.file', fragment='#comments', id=file.uid) }}
            </div>
            {% endif %}
            </div>
        </header>
    </div>
</section>
{% endblock %}
